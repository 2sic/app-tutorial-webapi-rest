<h2>Simple get content-items out of a query with REST</h2>
<p>
    The following demo shows how to use simple JavaScript to retrieve all Feedback Categories - sorted! thanks to a query.
</p>
<p>
    This uses jQuery to do the ajax and will add the returned items to the ol-tags. <br>
    Note that a query can return multiple lists, so the items are not directly in data[0...] but in data.<em>streamname</em>[...] so in this case it's data.Default.
</p>
<p>
    Note that it works for admins by default - to make it work for visitors you have to allow read-permissions for anonymous users (or users with view permissions). This is configured on the queries-types - for more infos read <a href="http://2sxc.org/help?tag=permissions">Permissions Help</a>. 
</p>
<h2>These is where the categories will appear</h2>
<div id="message"></div>
<ol id="categories">
</ol>

<script>

function getSortedCategories(moduleId) {
    // the following line gets a helper object for this module. Note that the placeholder Module:ModuleId will be turned into the module number on the server
    var moduleSxc = $2sxc(moduleId);
    var dnnSf = $.ServicesFramework(moduleId);

    // Here we ask the helper system for the full url to the REST
    var urlToAllItems = moduleSxc.resolveServiceUrl('app-query/Sorted Categories');

    $.ajax({
        url: urlToAllItems,
        beforeSend:  dnnSf.setModuleHeaders,
        success: function(data) {
            // use the data to show a message
            $('#message').html("Success, the $.ajax(...) worked! I found " + data.Default.length + " categories, the first one is '" + data.Default[0].Title + "'");
        
            // use the data to show a list of items
            var items = [];
            $.each(data.Default, function(idx, category) {
                items.push( "<li>" + category.Title + "</li>" );
            });
            $(items.join("")).appendTo($('#categories'));

        },
        error: function(jqXHR, textStatus, errorThrown){
            alert("Error:" + errorThrown);
        }
    });
};

// This call will execute the main function when the document is ready
// Don't try to execute it before, because the security features won't work yet
$(function() { 
    getSortedCategories([Module:ModuleId]) 
});
</script>

<!-- this includes the $2sxc helpers necessary to work --> 
<script src="/desktopmodules/tosic_sexycontent/js/2sxc.api.min.js"></script>

<!-- this script just has some tutorial-helpers, not relevant to understand the tutorial code -->
<script src="[App:Path]/assets/tutorial-helpers.js"></script>